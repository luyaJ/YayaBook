# UDP 和 TCP 的特点

UDP（用户数据报协议User Datagram Protocol）是无连接的，尽最大可能交互，没有拥塞控制、面向报文（对于应用程序传下来的报文不合并也不拆分，只是添加 UDP 首部），支持一对一、一对多、多对一和多对多的交互通信。

TCP（传输控制协议Transmission Control Protocol）是面向连接的，提供可靠交付，有流量控制，拥塞控制，提供全双工通信，面向字节流，每一条 TCP 连接只能是点对点的（一对一）。

# TCP 三次握手

* **确认号**：期望收到的下一个报文段的序号。
* **同步SYN**：在连接建立时用来同步序号。
* **确认ACK**：当 ACK=1 时确认号字段有效，否则无效。TCP 规定，在连接建立后所有传送的报文段都必须把 ACK 置为 1。

1. 首先服务器端处于 LISTEN（监听）状态，等待客户的连接请求。
2. 客户端向服务端发送请求报文，SYN=1，ACK=0，选择一个初始的序号x。
3. 服务器端收到连接请求报文，如果同意建立连接，就会向客户端发送连接确认报文，SYN=1，ACK=1，确认号为 x+1，同时也选择一个初始序号 y。
4. 客户端收到服务器端的连接确认报文后，还要像服务器端发出确认，确认号为 y+1，序号为 x+1。
5. 服务器端收到客户端的确认后，连接建立。

## 三次握手原因

原因：为了防止失效的连接请求到达服务器，让服务器错误打开连接。

客户端发送连接请求如果在网络中滞留，那么就会隔很长一段时间才能收到服务器端发出的连接确认。客户端等待一个超时重传时间之后，就会重新请求连接，但是这个滞留的连接请求最后还是会到达服务器，如果不进行三次握手，那么服务器就会打开两个连接。如果有第三次握手，客户端会忽略服务器之后发送的对滞留连接请求的连接确认，不进行第三次握手，因此就不会再次打开连接。

# TCP 四次挥手

* **中止 FIN**：用来释放一个连接，当 FIN=1 时，表示此报文段的发送方的数据已发送完毕，并要求释放连接。

1. 客户端发送释放报文，FIN=1。
2. 服务器端收到之后发出确认，此时 TCP 属于半关闭状态，服务器端能向客户端发送数据，但是客户端不能向服务器端发送数据。
3. 当服务器端不再需要连接时，发送释放报文，FIN=1。
4. 客户端收到后发出确认，进入 TIME-WAIT 状态，等待 2 MSL（最大报文存活时间）后释放连接。
5. 服务器端收到客户端的确认后释放连接。

## 四次挥手的原因

客户端发送了 FIN 连接释放报文之后，服务器收到了这个报文，就进入了 CLOSE-WAIT 状态。这个状态是为了让服务器端发送还未传送完毕的数据，传送完毕之后，服务器会发送 FIN 连接释放报文。